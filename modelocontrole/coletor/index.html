<!doctype html>
<html lang="pt-br" data-bs-theme="light">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Simulador — UFSC</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <link rel="stylesheet" href="style.css" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4Q8cfBIriVTbGkWJvGysqc1TMAwVdePfsFCf2TYMpeksTCJkI" crossorigin="anonymous">
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGjKriETRi6F/4xLxtNlYJNcROH0IqcE0pclpoKspvZxLvb1xflyHhCrE/v" crossorigin="anonymous"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURPlLJSzFsgvp3lGlOEBd+2N+BIYLJms9S2G6pIII+q5Sj82CooVrw" crossorigin="anonymous"></script>
        <script>
            // Configura o auto-render do KaTeX para usar $..$ e $$..$$
            document.addEventListener("DOMContentLoaded", function() {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true},
                        {left: "$", right: "$", display: false}
                    ]
                });
            });
        </script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
<nav class="navbar navbar-expand-lg ufsc-nav sticky-top shadow-sm border-bottom border-warning border-4" data-bs-theme="dark">
  <div class="container-fluid main-container">
    <a class="navbar-brand d-flex align-items-center fw-bold" href="/">
      <span class="crest me-2" aria-hidden="true">
        <img src="/logoufsc.png" height="40" alt="">
      </span>
      <span class="brand-text">UFSC</span>
    </a>

    <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Alternar navegação">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto align-items-lg-center">
        <li class="nav-item">
          <a class="nav-link ufsc-link active" href="#home">Home</a>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle ufsc-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Simulações
          </a>
          <ul class="dropdown-menu dropdown-menu-end ufsc-dropdown">
            <li><a class="dropdown-item active" href="#sim-coletor">Coletor Solar (PID)</a></li>
            <li><a class="dropdown-item" href="#" data-coming-soon>Caldeira</a></li>
            <li><a class="dropdown-item" href="#" data-coming-soon>Eletrolizador</a></li>
          </ul>
        </li>

        <li class="nav-item">
          <a class="nav-link ufsc-link text-white-50" href="#" data-coming-soon>Documentação</a>
        </li>
        <li class="nav-item">
          <a class="nav-link ufsc-link text-white-50" href="#" data-coming-soon>Sobre</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


    <header id="home" class="hero py-4">
        <div class="container-fluid main-container hero-inner">
            <div class="row align-items-center g-4">
                <div class="col-lg-8">
                    <h1 class="display-5 fw-bold">Laboratório de Simulação — UFSC</h1>
                    <p class="fs-5 text-muted">Ambiente didático com modelos térmicos e energéticos. Selecione uma
                        simulação e execute em <strong>modo rápido</strong>: o app calcula tudo e só então plota.</p>
                    <a href="#sim-coletor" class="btn btn-primary btn-lg">Abrir Coletor Solar</a>
                </div>
                <div class="col-lg-4">
                    <div class="border rounded-3 p-3 bg-white shadow-sm text-center">
                        <div class="sig text-muted small">Produzido por</div>
                        <div class="name fs-5 fw-bold">Davi de Lima Rosa</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main id="sim-coletor" class="container-fluid main-container py-4">
        <div class="row g-3">

            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h2>Modo de Tempo</h2>
                        <p class="text-muted small">Para relatórios, use <b>Tempo Simulado</b> com execução rápida:
                            calcula todo o intervalo e só então desenha os gráficos.</p>

                        <div class="time-mode border p-3 rounded-3 bg-light">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="timeMode" value="real" id="tmReal"
                                    checked>
                                <label class="form-check-label" for="tmReal">Tempo Real (usa valores atuais)</label>
                            </div>
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="radio" name="timeMode" value="sim" id="tmSim">
                                <label class="form-check-label" for="tmSim">Tempo Simulado (perfil/CSV)</label>
                            </div>
                        </div>

                        <div id="simulatedBlock" class="sim-block hidden mt-3">
                            <div class="row mb-2 align-items-center">
                                <label for="simStart" class="col-sm-5 col-form-label">Início (HH:MM)</label>
                                <div class="col-sm-7">
                                    <input id="simStart" type="text" value="08:00" class="form-control form-control-sm"
                                        placeholder="ex.: 08:00" />
                                </div>
                            </div>
                            <div class="row mb-2 align-items-center">
                                <label for="simEnd" class="col-sm-5 col-form-label">Fim (HH:MM)</label>
                                <div class="col-sm-7">
                                    <input id="simEnd" type="text" value="18:00" class="form-control form-control-sm"
                                        placeholder="ex.: 18:00" />
                                </div>
                            </div>
                            <div class="row mb-2 align-items-center">
                                <label for="simStep" class="col-sm-5 col-form-label">Minutos por passo</label>
                                <div class="col-sm-7">
                                    <input id="simStep" type="number" min="0.5" step="0.5" value="2"
                                        class="form-control form-control-sm" />
                                </div>
                            </div>
                            <div class="form-check form-switch mt-2 ms-1">
                                <input class="form-check-input" type="checkbox" role="switch" id="fastRun" checked>
                                <label class="form-check-label" for="fastRun">Execução rápida</label>
                            </div>
                        </div>

                        <div class="status d-flex gap-4 mt-3 text-muted">
                            <div><strong>Status:</strong> <span id="statusMsg">Pronto</span></div>
                            <div><strong>Hora:</strong> <span id="clockNow">—</span></div>
                        </div>

                        <div class="actions d-flex gap-2 mt-3 flex-wrap">
                            <button id="startBtn" class="btn btn-primary fw-bold">Iniciar simulação</button>
                            <button id="resetBtn" class="btn btn-secondary">Resetar</button>
                            <button id="constBtn" class="btn btn-outline-secondary ms-auto">Constantes do
                                Coletor</button>
                        </div>
                        <small class="text-muted d-block mt-3">Δt numérico = 1.5 s · Vazão nominal = 0.02 kg/s · Nseg =
                            5</small>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h2>Parâmetros do Ensaio</h2>
                        <p class="text-muted small">Em <b>Tempo Simulado</b>, Irradiação e Ta podem vir do CSV ou do
                            perfil padrão.</p>

                        <div class="row mb-1 align-items-center">
                            <label for="irr" class="col-sm-4 col-form-label text-muted">Irradiação (W/m²)</label>
                            <div class="col-sm-6">
                                <input id="irr" type="range" min="0" max="1100" step="10" value="800"
                                    class="form-range">
                            </div>
                            <div class="col-sm-2 text-end">
                                <span id="irr_val" class="fw-bold">800</span>
                            </div>
                        </div>

                        <div class="row mb-1 align-items-center">
                            <label for="ta" class="col-sm-4 col-form-label text-muted">Temp. ambiente (°C)</label>
                            <div class="col-sm-6">
                                <input id="ta" type="range" min="0" max="50" step="0.5" value="25" class="form-range">
                            </div>
                            <div class="col-sm-2 text-end">
                                <span id="ta_val" class="fw-bold">25.0</span>
                            </div>
                        </div>

                        <div class="row mb-1 align-items-center">
                            <label for="ref" class="col-sm-4 col-form-label text-muted">Referência (°C)</label>
                            <div class="col-sm-6">
                                <input id="ref" type="range" min="25" max="85" step="0.5" value="55" class="form-range">
                            </div>
                            <div class="col-sm-2 text-end">
                                <span id="ref_val" class="fw-bold">55.0</span>
                            </div>
                        </div>

                        <div class="row mb-3 align-items-center">
                            <label for="vaz" class="col-sm-4 col-form-label text-muted">Vazão inicial (%)</label>
                            <div class="col-sm-6">
                                <input id="vaz" type="range" min="10" max="100" step="1" value="50" class="form-range">
                            </div>
                            <div class="col-sm-2 text-end">
                                <span id="vaz_val" class="fw-bold">50%</span>
                            </div>
                        </div>

                        <h3 class="h5">PID</h3>
                        <div class="row mb-1 align-items-center">
                            <label for="kp" class="col-sm-4 col-form-label text-muted">Kp</label>
                            <div class="col-sm-6">
                                <input id="kp" type="range" min="0" max="2.0" step="0.01" value="0.50"
                                    class="form-range">
                            </div>
                            <div class="col-sm-2 text-end">
                                <span id="kp_val" class="fw-bold">0.50</span>
                            </div>
                        </div>
                        <div class="row mb-1 align-items-center">
                            <label for="ki" class="col-sm-4 col-form-label text-muted">Ki</label>
                            <div class="col-sm-6">
                                <input id="ki" type="range" min="0" max="1.0" step="0.01" value="0.10"
                                    class="form-range">
                            </div>
                            <div class="col-sm-2 text-end">
                                <span id="ki_val" class="fw-bold">0.10</span>
                            </div>
                        </div>
                        <div class="row mb-1 align-items-center">
                            <label for="kd" class="col-sm-4 col-form-label text-muted">Kd</label>
                            <div class="col-sm-6">
                                <input id="kd" type="range" min="0" max="1.0" step="0.005" value="0.125"
                                    class="form-range">
                            </div>
                            <div class="col-sm-2 text-end">
                                <span id="kd_val" class="fw-bold">0.125</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h2>Perfil por CSV (tempo simulado)</h2>
                        <p class="text-muted small">Formato: <code>HH:MM, irradiacao, temperatura</code>. Ex.:
                            <code>12:30, 750, 26.5</code>.</p>
                        <input id="csvFile" type="file" accept=".csv,text/csv" class="form-control">
                        <div class="status d-flex gap-4 mt-3 text-muted">
                            <div><strong>Pontos CSV:</strong> <span id="csvCount">0</span></div>
                            <div><strong>Faixa CSV:</strong> <span id="csvSpan">—</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h2>Indicadores do resultado</h2>
                        <div class="row row-cols-2 row-cols-md-4 g-2 kpis">
                            <div class="col">
                                <div class="kpi border rounded-3 p-2">
                                    <span class="small text-muted">η (eficiência)</span>
                                    <strong class="d-block fs-5" id="eta">—</strong>
                                </div>
                            </div>
                            <div class="col">
                                <div class="kpi border rounded-3 p-2">
                                    <span class="small text-muted">ΔT (Tout−Tin)</span>
                                    <strong class="d-block fs-5" id="dT">—</strong>
                                </div>
                            </div>
                            <div class="col">
                                <div class="kpi border rounded-3 p-2">
                                    <span class="small text-muted">ṁ (kg/s)</span>
                                    <strong class="d-block fs-5" id="mdot">—</strong>
                                </div>
                            </div>
                            <div class="col">
                                <div class="kpi border rounded-3 p-2">
                                    <span class="small text-muted">Ref (°C)</span>
                                    <strong class="d-block fs-5" id="refNow">—</strong>
                                </div>
                            </div>
                        </div>
                        <div class="stats row row-cols-2 g-2 mt-2">
                            <div class="col"><strong>T<sub>in</sub> (°C):</strong> <span id="Tin">—</span></div>
                            <div class="col"><strong>T<sub>out</sub> (°C):</strong> <span id="Tout">—</span></div>
                            <div class="col"><strong>T<sub>p</sub> (°C):</strong> <span id="Tp">—</span></div>
                            <div class="col"><strong>Vazão (%):</strong> <span id="vazao_pct">—</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="h5">Temperaturas</h2>
                        <canvas id="chartTemp" height="140"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="h5">Vazão (% nominal)</h2>
                        <canvas id="chartVazao" height="140"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="h5">Potências térmicas (W)</h2>
                        <canvas id="chartPower" height="140"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="h5">Erro de controle (Tout − Ref)</h2>
                        <canvas id="chartErro" height="140"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="h5">Perfil de Irradiação ☀️ & Ta</h2>
                        <canvas id="chartIrrTa" height="120"></canvas>
                        <small class="text-muted">Dois eixos Y: à esquerda Irr (W/m²) e à direita Ta (°C).</small>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="modal fade" id="constModal" tabindex="-1" aria-labelledby="constTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="constTitle">Constantes do Coletor</h1>
                    <button type="button" class="btn-close" id="closeConst" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="frm row g-3">
                        <div class="col-md-6">
                            <label for="c_Ac" class="form-label small text-muted">Ac (m²)</label>
                            <input id="c_Ac" type="number" step="0.01" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="c_U" class="form-label small text-muted">U (W/m²·K)</label>
                            <input id="c_U" type="number" step="0.1" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="c_tau" class="form-label small text-muted">τ·α</label>
                            <input id="c_tau" type="number" step="0.01" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="c_Nseg" class="form-label small text-muted">Nseg</label>
                            <input id="c_Nseg" type="number" step="1" min="1" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="c_Vcol" class="form-label small text-muted">V_col (m³)</label>
                            <input id="c_Vcol" type="number" step="0.0005" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="c_mp" class="form-label small text-muted">mp (kg)</label>
                            <input id="c_mp" type="number" step="0.1" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="c_cpp" class="form-label small text-muted">cpp (J/kg·K)</label>
                            <input id="c_cpp" type="number" step="10" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="c_hA" class="form-label small text-muted">hA_total (W/K)</label>
                            <input id="c_hA" type="number" step="1" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="c_UAt" class="form-label small text-muted">UA_tubos_total (W/K)</label>
                            <input id="c_UAt" type="number" step="0.5" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="c_Vloop" class="form-label small text-muted">V_loop (m³)</label>
                            <input id="c_Vloop" type="number" step="0.0005" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="c_UAl" class="form-label small text-muted">UA_loop (W/K)</label>
                            <input id="c_UAl" type="number" step="0.5" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="c_dt" class="form-label small text-muted">Δt numérico (s)</label>
                            <input id="c_dt" type="number" step="0.1" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="c_vazN" class="form-label small text-muted">Vazão nominal (kg/s)</label>
                            <input id="c_vazN" type="number" step="0.001" class="form-control">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancelConst" type="button" class="btn btn-secondary">Cancelar</button>
                    <button id="applyConst" type="button" class="btn btn-primary">Aplicar e Resetar</button>
                </div>
            </div>
        </div>
    </div>


    

    <div id="toast" class="toast hidden">Em breve…</div>

    <footer class="ufsc-footer">
        <div class="container-fluid main-container ufsc-footer-inner">
            <div class="left">
                <div class="logo">UFSC</div>
                <div class="name">Universidade Federal de Santa Catarina</div>
                <div class="dept">Engenharia de Controle e Automação — Simulação de Sistemas Térmicos</div>
            </div>
            <div class="right">
                <div>© 2025 UFSC — Uso acadêmico</div>
                <div>Desenvolvido por <b>Davi de Lima Rosa</b></div>
                <div><a href="#" data-coming-soon>Acessibilidade</a> · <a href="#" data-coming-soon>Política de
                        Privacidade</a></div>
            </div>
        </div>
        <div class="bar"></div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="app.js"></script>
</body>

</html>